[2025-07-13 12:08:28,058] [INFO] __main__: ================================================================================
[2025-07-13 12:08:28,058] [INFO] __main__: FEDERATED TRAINING FOR DO-TP MODEL
[2025-07-13 12:08:28,058] [INFO] __main__: ================================================================================
[2025-07-13 12:08:28,058] [INFO] __main__: Experiment: federated_training_20250713_120510
[2025-07-13 12:08:28,058] [INFO] __main__: Client datasets: ['eth', 'hotel', 'zara1', 'zara2', 'univ']
[2025-07-13 12:08:28,058] [INFO] __main__: Validation dataset: zara1
[2025-07-13 12:08:28,058] [INFO] __main__: Global rounds: 3
[2025-07-13 12:08:28,058] [INFO] __main__: Local epochs: 7
[2025-07-13 12:08:28,058] [INFO] __main__: Clients per round: 5
[2025-07-13 12:08:28,058] [INFO] __main__: Aggregation method: weighted_avg
[2025-07-13 12:08:28,058] [INFO] __main__: Output directory: ./results/experiment_20250713_120510/federated
[2025-07-13 12:08:28,058] [INFO] __main__: Setting up data manager...
[2025-07-13 12:08:28,059] [INFO] core.data_manager: All required datasets are available
[2025-07-13 12:08:30,467] [INFO] core.data_manager: Loaded eth train dataset with 2785 samples
[2025-07-13 12:08:30,809] [INFO] core.data_manager: Loaded eth val dataset with 660 samples
[2025-07-13 12:08:31,055] [INFO] core.data_manager: Loaded eth test dataset with 70 samples
[2025-07-13 12:08:33,327] [INFO] core.data_manager: Loaded hotel train dataset with 2594 samples
[2025-07-13 12:08:33,658] [INFO] core.data_manager: Loaded hotel val dataset with 621 samples
[2025-07-13 12:08:34,038] [INFO] core.data_manager: Loaded hotel test dataset with 301 samples
[2025-07-13 12:08:36,355] [INFO] core.data_manager: Loaded zara1 train dataset with 2322 samples
[2025-07-13 12:08:36,700] [INFO] core.data_manager: Loaded zara1 val dataset with 605 samples
[2025-07-13 12:08:36,937] [INFO] core.data_manager: Loaded zara1 test dataset with 602 samples
[2025-07-13 12:08:39,082] [INFO] core.data_manager: Loaded zara2 train dataset with 2112 samples
[2025-07-13 12:08:39,377] [INFO] core.data_manager: Loaded zara2 val dataset with 501 samples
[2025-07-13 12:08:39,914] [INFO] core.data_manager: Loaded zara2 test dataset with 921 samples
[2025-07-13 12:08:41,074] [INFO] core.data_manager: Loaded univ train dataset with 2076 samples
[2025-07-13 12:08:41,284] [INFO] core.data_manager: Loaded univ val dataset with 530 samples
[2025-07-13 12:08:42,952] [INFO] core.data_manager: Loaded univ test dataset with 947 samples
[2025-07-13 12:08:42,953] [INFO] __main__: Dataset statistics:
[2025-07-13 12:08:42,953] [INFO] __main__:   eth: train=2785, val=660, test=70
[2025-07-13 12:08:42,953] [INFO] __main__:   hotel: train=2594, val=621, test=301
[2025-07-13 12:08:42,953] [INFO] __main__:   zara1: train=2322, val=605, test=602
[2025-07-13 12:08:42,953] [INFO] __main__:   zara2: train=2112, val=501, test=921
[2025-07-13 12:08:42,953] [INFO] __main__:   univ: train=2076, val=530, test=947
[2025-07-13 12:08:42,953] [INFO] __main__: Creating federated client data loaders...
[2025-07-13 12:08:42,953] [INFO] core.data_manager: Preparing federated client data from datasets: ['eth', 'hotel', 'zara1', 'zara2', 'univ']
[2025-07-13 12:08:45,316] [INFO] core.data_manager: Loaded eth train dataset with 2785 samples
[2025-07-13 12:08:47,601] [INFO] core.data_manager: Loaded hotel train dataset with 2594 samples
[2025-07-13 12:08:49,934] [INFO] core.data_manager: Loaded zara1 train dataset with 2322 samples
[2025-07-13 12:08:52,049] [INFO] core.data_manager: Loaded zara2 train dataset with 2112 samples
[2025-07-13 12:08:53,202] [INFO] core.data_manager: Loaded univ train dataset with 2076 samples
[2025-07-13 12:08:53,202] [INFO] core.data_manager: Created 5 federated clients
[2025-07-13 12:08:53,202] [INFO] core.data_manager: Preparing validation data from dataset: zara1
[2025-07-13 12:08:53,540] [INFO] core.data_manager: Loaded zara1 val dataset with 605 samples
[2025-07-13 12:08:53,540] [INFO] __main__: Created 5 federated clients
[2025-07-13 12:08:53,540] [INFO] __main__:   Client eth: 2785 samples
[2025-07-13 12:08:53,540] [INFO] __main__:   Client hotel: 2594 samples
[2025-07-13 12:08:53,540] [INFO] __main__:   Client zara1: 2322 samples
[2025-07-13 12:08:53,540] [INFO] __main__:   Client zara2: 2112 samples
[2025-07-13 12:08:53,540] [INFO] __main__:   Client univ: 2076 samples
[2025-07-13 12:08:53,540] [INFO] __main__: Validation samples: 605
[2025-07-13 12:08:53,540] [INFO] __main__: Creating federated trainer...
[2025-07-13 12:08:53,540] [INFO] core.training: Using CPU
[2025-07-13 12:08:53,540] [INFO] core.federated: Federated trainer initialized with 5 clients
[2025-07-13 12:08:53,540] [INFO] core.federated: Client weights: {'eth': 0.23425014719488602, 'hotel': 0.21818487677685255, 'zara1': 0.19530658591975775, 'zara2': 0.17764319959626546, 'univ': 0.1746151905122382}
[2025-07-13 12:08:53,540] [INFO] __main__: Client statistics:
[2025-07-13 12:08:53,540] [INFO] __main__:   Total clients: 5
[2025-07-13 12:08:53,540] [INFO] __main__:   Total samples: 11889
[2025-07-13 12:08:53,540] [INFO] __main__:   Client weights:
[2025-07-13 12:08:53,540] [INFO] __main__:     eth: 0.2343
[2025-07-13 12:08:53,540] [INFO] __main__:     hotel: 0.2182
[2025-07-13 12:08:53,540] [INFO] __main__:     zara1: 0.1953
[2025-07-13 12:08:53,540] [INFO] __main__:     zara2: 0.1776
[2025-07-13 12:08:53,540] [INFO] __main__:     univ: 0.1746
[2025-07-13 12:08:53,542] [INFO] __main__: Configuration saved to ./results/experiment_20250713_120510/federated/federated_training_20250713_120510_config.json
[2025-07-13 12:08:53,542] [INFO] __main__: Starting federated training...
[2025-07-13 12:08:53,543] [INFO] core.federated: Starting federated training for 3 rounds
[2025-07-13 12:08:53,543] [INFO] core.federated: --- Global Round 1/3 ---
[2025-07-13 12:08:53,543] [INFO] core.federated: Training client: eth
[2025-07-13 12:09:15,558] [INFO] core.federated: Training client: hotel
[2025-07-13 12:09:36,371] [INFO] core.federated: Training client: zara1
[2025-07-13 12:09:56,403] [INFO] core.federated: Training client: zara2
[2025-07-13 12:10:15,294] [INFO] core.federated: Training client: univ
[2025-07-13 12:10:29,470] [INFO] core.federated: Aggregating model updates...
[2025-07-13 12:10:30,890] [INFO] core.federated: Round 1 - Val Loss: 0.0096, ADE: 1.2687, FDE: 2.4891
[2025-07-13 12:10:30,893] [INFO] core.federated: Saved checkpoint: do_tp_federated_federated_round_1.pt
[2025-07-13 12:10:30,894] [INFO] core.federated: --- Global Round 2/3 ---
[2025-07-13 12:10:30,894] [INFO] core.federated: Training client: eth
[2025-07-13 12:10:52,560] [INFO] core.federated: Training client: hotel
[2025-07-13 12:11:13,727] [INFO] core.federated: Training client: zara1
[2025-07-13 12:11:33,914] [INFO] core.federated: Training client: zara2
[2025-07-13 12:11:53,102] [INFO] core.federated: Training client: univ
[2025-07-13 12:12:07,467] [INFO] core.federated: Aggregating model updates...
[2025-07-13 12:12:08,862] [INFO] core.federated: Round 2 - Val Loss: 0.0095, ADE: 1.2652, FDE: 2.4843
[2025-07-13 12:12:08,863] [INFO] core.federated: Saved checkpoint: do_tp_federated_federated_round_2.pt
[2025-07-13 12:12:08,863] [INFO] core.federated: --- Global Round 3/3 ---
[2025-07-13 12:12:08,863] [INFO] core.federated: Training client: eth
[2025-07-13 12:12:30,566] [INFO] core.federated: Training client: hotel
[2025-07-13 12:12:51,660] [INFO] core.federated: Training client: zara1
[2025-07-13 12:13:11,843] [INFO] core.federated: Training client: zara2
[2025-07-13 12:13:31,021] [INFO] core.federated: Training client: univ
[2025-07-13 12:13:45,589] [INFO] core.federated: Aggregating model updates...
[2025-07-13 12:13:46,998] [INFO] core.federated: Round 3 - Val Loss: 0.0094, ADE: 1.2666, FDE: 2.4865
[2025-07-13 12:13:46,999] [INFO] core.federated: Saved checkpoint: do_tp_federated_federated_round_3.pt
[2025-07-13 12:13:47,000] [INFO] core.federated: Final federated model saved: do_tp_federated_federated_final.pt
[2025-07-13 12:13:47,001] [INFO] __main__: Federated training completed!
[2025-07-13 12:13:47,001] [INFO] __main__: Best validation metrics:
[2025-07-13 12:13:47,001] [INFO] __main__:   Round: 3
[2025-07-13 12:13:47,001] [INFO] __main__:   Loss: 0.0094
[2025-07-13 12:13:47,001] [INFO] __main__:   ADE: 1.2666
[2025-07-13 12:13:47,001] [INFO] __main__:   FDE: 2.4865
[2025-07-13 12:13:47,001] [INFO] __main__: Creating training plots...
[2025-07-13 12:13:47,344] [INFO] __main__: Federated training progress plots saved
[2025-07-13 12:13:47,345] [INFO] __main__: Training metrics saved to ./results/experiment_20250713_120510/federated/federated_training_20250713_120510_metrics.json
[2025-07-13 12:13:47,345] [INFO] __main__: Federated training completed successfully!
