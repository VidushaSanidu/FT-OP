[2025-07-26 15:52:21,651] [INFO] __main__: ================================================================================
[2025-07-26 15:52:21,651] [INFO] __main__: FEDERATED TRAINING FOR DO-TP MODEL
[2025-07-26 15:52:21,651] [INFO] __main__: ================================================================================
[2025-07-26 15:52:21,651] [INFO] __main__: Experiment: federated_training_20250726_155220
[2025-07-26 15:52:21,651] [INFO] __main__: Client datasets: ['eth', 'hotel', 'zara1', 'zara2', 'univ']
[2025-07-26 15:52:21,651] [INFO] __main__: Validation dataset: zara1
[2025-07-26 15:52:21,651] [INFO] __main__: Global rounds: 10
[2025-07-26 15:52:21,651] [INFO] __main__: Local epochs: 7
[2025-07-26 15:52:21,651] [INFO] __main__: Clients per round: 5
[2025-07-26 15:52:21,651] [INFO] __main__: Aggregation method: weighted_avg
[2025-07-26 15:52:21,651] [INFO] __main__: Output directory: ./results/experiment_20250726_155220/federated
[2025-07-26 15:52:21,651] [INFO] __main__: Setting up data manager...
[2025-07-26 15:52:21,651] [INFO] core.data_manager: All required datasets are available
[2025-07-26 15:52:23,987] [INFO] core.data_manager: Loaded eth train dataset with 2785 samples
[2025-07-26 15:52:24,322] [INFO] core.data_manager: Loaded eth val dataset with 660 samples
[2025-07-26 15:52:24,562] [INFO] core.data_manager: Loaded eth test dataset with 70 samples
[2025-07-26 15:52:26,792] [INFO] core.data_manager: Loaded hotel train dataset with 2594 samples
[2025-07-26 15:52:27,115] [INFO] core.data_manager: Loaded hotel val dataset with 621 samples
[2025-07-26 15:52:27,486] [INFO] core.data_manager: Loaded hotel test dataset with 301 samples
[2025-07-26 15:52:29,750] [INFO] core.data_manager: Loaded zara1 train dataset with 2322 samples
[2025-07-26 15:52:30,086] [INFO] core.data_manager: Loaded zara1 val dataset with 605 samples
[2025-07-26 15:52:30,319] [INFO] core.data_manager: Loaded zara1 test dataset with 602 samples
[2025-07-26 15:52:32,409] [INFO] core.data_manager: Loaded zara2 train dataset with 2112 samples
[2025-07-26 15:52:32,698] [INFO] core.data_manager: Loaded zara2 val dataset with 501 samples
[2025-07-26 15:52:33,223] [INFO] core.data_manager: Loaded zara2 test dataset with 921 samples
[2025-07-26 15:52:34,359] [INFO] core.data_manager: Loaded univ train dataset with 2076 samples
[2025-07-26 15:52:34,566] [INFO] core.data_manager: Loaded univ val dataset with 530 samples
[2025-07-26 15:52:36,213] [INFO] core.data_manager: Loaded univ test dataset with 947 samples
[2025-07-26 15:52:36,214] [INFO] __main__: Dataset statistics:
[2025-07-26 15:52:36,214] [INFO] __main__:   eth: train=2785, val=660, test=70
[2025-07-26 15:52:36,214] [INFO] __main__:   hotel: train=2594, val=621, test=301
[2025-07-26 15:52:36,214] [INFO] __main__:   zara1: train=2322, val=605, test=602
[2025-07-26 15:52:36,214] [INFO] __main__:   zara2: train=2112, val=501, test=921
[2025-07-26 15:52:36,214] [INFO] __main__:   univ: train=2076, val=530, test=947
[2025-07-26 15:52:36,214] [INFO] __main__: Creating federated client data loaders...
[2025-07-26 15:52:36,214] [INFO] core.data_manager: Preparing federated client data from datasets: ['eth', 'hotel', 'zara1', 'zara2', 'univ']
[2025-07-26 15:52:38,531] [INFO] core.data_manager: Loaded eth train dataset with 2785 samples
[2025-07-26 15:52:40,766] [INFO] core.data_manager: Loaded hotel train dataset with 2594 samples
[2025-07-26 15:52:43,068] [INFO] core.data_manager: Loaded zara1 train dataset with 2322 samples
[2025-07-26 15:52:45,176] [INFO] core.data_manager: Loaded zara2 train dataset with 2112 samples
[2025-07-26 15:52:46,330] [INFO] core.data_manager: Loaded univ train dataset with 2076 samples
[2025-07-26 15:52:46,330] [INFO] core.data_manager: Created 5 federated clients
[2025-07-26 15:52:46,330] [INFO] core.data_manager: Preparing validation data from dataset: zara1
[2025-07-26 15:52:46,670] [INFO] core.data_manager: Loaded zara1 val dataset with 605 samples
[2025-07-26 15:52:46,670] [INFO] __main__: Created 5 federated clients
[2025-07-26 15:52:46,670] [INFO] __main__:   Client eth: 2785 samples
[2025-07-26 15:52:46,670] [INFO] __main__:   Client hotel: 2594 samples
[2025-07-26 15:52:46,670] [INFO] __main__:   Client zara1: 2322 samples
[2025-07-26 15:52:46,670] [INFO] __main__:   Client zara2: 2112 samples
[2025-07-26 15:52:46,670] [INFO] __main__:   Client univ: 2076 samples
[2025-07-26 15:52:46,670] [INFO] __main__: Validation samples: 605
[2025-07-26 15:52:46,670] [INFO] __main__: Creating federated trainer...
[2025-07-26 15:52:46,670] [INFO] core.training: Using CPU
[2025-07-26 15:52:46,670] [INFO] core.federated: Federated trainer initialized with 5 clients
[2025-07-26 15:52:46,671] [INFO] core.federated: Client weights: {'eth': 0.23425014719488602, 'hotel': 0.21818487677685255, 'zara1': 0.19530658591975775, 'zara2': 0.17764319959626546, 'univ': 0.1746151905122382}
[2025-07-26 15:52:46,671] [INFO] __main__: Client statistics:
[2025-07-26 15:52:46,671] [INFO] __main__:   Total clients: 5
[2025-07-26 15:52:46,671] [INFO] __main__:   Total samples: 11889
[2025-07-26 15:52:46,671] [INFO] __main__:   Client weights:
[2025-07-26 15:52:46,671] [INFO] __main__:     eth: 0.2343
[2025-07-26 15:52:46,671] [INFO] __main__:     hotel: 0.2182
[2025-07-26 15:52:46,671] [INFO] __main__:     zara1: 0.1953
[2025-07-26 15:52:46,671] [INFO] __main__:     zara2: 0.1776
[2025-07-26 15:52:46,671] [INFO] __main__:     univ: 0.1746
[2025-07-26 15:52:46,671] [INFO] __main__: Configuration saved to ./results/experiment_20250726_155220/federated/federated_training_20250726_155220_config.json
[2025-07-26 15:52:46,671] [INFO] __main__: Starting federated training...
[2025-07-26 15:52:46,672] [INFO] core.federated: Starting federated training for 10 rounds
[2025-07-26 15:52:46,672] [INFO] core.federated: --- Global Round 1/10 ---
[2025-07-26 15:52:46,672] [INFO] core.federated: Training client: eth
[2025-07-26 15:53:08,780] [INFO] core.federated: Training client: hotel
