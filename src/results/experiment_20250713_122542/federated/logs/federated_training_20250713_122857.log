[2025-07-13 12:28:57,658] [INFO] __main__: ================================================================================
[2025-07-13 12:28:57,658] [INFO] __main__: FEDERATED TRAINING FOR DO-TP MODEL
[2025-07-13 12:28:57,658] [INFO] __main__: ================================================================================
[2025-07-13 12:28:57,658] [INFO] __main__: Experiment: federated_training_20250713_122542
[2025-07-13 12:28:57,658] [INFO] __main__: Client datasets: ['eth', 'hotel', 'zara1', 'zara2', 'univ']
[2025-07-13 12:28:57,658] [INFO] __main__: Validation dataset: zara1
[2025-07-13 12:28:57,658] [INFO] __main__: Global rounds: 3
[2025-07-13 12:28:57,658] [INFO] __main__: Local epochs: 7
[2025-07-13 12:28:57,658] [INFO] __main__: Clients per round: 5
[2025-07-13 12:28:57,658] [INFO] __main__: Aggregation method: weighted_avg
[2025-07-13 12:28:57,658] [INFO] __main__: Output directory: ./results/experiment_20250713_122542/federated
[2025-07-13 12:28:57,658] [INFO] __main__: Setting up data manager...
[2025-07-13 12:28:57,658] [INFO] core.data_manager: All required datasets are available
[2025-07-13 12:29:00,074] [INFO] core.data_manager: Loaded eth train dataset with 2785 samples
[2025-07-13 12:29:00,417] [INFO] core.data_manager: Loaded eth val dataset with 660 samples
[2025-07-13 12:29:00,662] [INFO] core.data_manager: Loaded eth test dataset with 70 samples
[2025-07-13 12:29:02,938] [INFO] core.data_manager: Loaded hotel train dataset with 2594 samples
[2025-07-13 12:29:03,269] [INFO] core.data_manager: Loaded hotel val dataset with 621 samples
[2025-07-13 12:29:03,652] [INFO] core.data_manager: Loaded hotel test dataset with 301 samples
[2025-07-13 12:29:05,968] [INFO] core.data_manager: Loaded zara1 train dataset with 2322 samples
[2025-07-13 12:29:06,312] [INFO] core.data_manager: Loaded zara1 val dataset with 605 samples
[2025-07-13 12:29:06,549] [INFO] core.data_manager: Loaded zara1 test dataset with 602 samples
[2025-07-13 12:29:08,692] [INFO] core.data_manager: Loaded zara2 train dataset with 2112 samples
[2025-07-13 12:29:08,987] [INFO] core.data_manager: Loaded zara2 val dataset with 501 samples
[2025-07-13 12:29:09,524] [INFO] core.data_manager: Loaded zara2 test dataset with 921 samples
[2025-07-13 12:29:10,685] [INFO] core.data_manager: Loaded univ train dataset with 2076 samples
[2025-07-13 12:29:10,895] [INFO] core.data_manager: Loaded univ val dataset with 530 samples
[2025-07-13 12:29:12,565] [INFO] core.data_manager: Loaded univ test dataset with 947 samples
[2025-07-13 12:29:12,565] [INFO] __main__: Dataset statistics:
[2025-07-13 12:29:12,565] [INFO] __main__:   eth: train=2785, val=660, test=70
[2025-07-13 12:29:12,565] [INFO] __main__:   hotel: train=2594, val=621, test=301
[2025-07-13 12:29:12,565] [INFO] __main__:   zara1: train=2322, val=605, test=602
[2025-07-13 12:29:12,565] [INFO] __main__:   zara2: train=2112, val=501, test=921
[2025-07-13 12:29:12,565] [INFO] __main__:   univ: train=2076, val=530, test=947
[2025-07-13 12:29:12,565] [INFO] __main__: Creating federated client data loaders...
[2025-07-13 12:29:12,565] [INFO] core.data_manager: Preparing federated client data from datasets: ['eth', 'hotel', 'zara1', 'zara2', 'univ']
[2025-07-13 12:29:14,926] [INFO] core.data_manager: Loaded eth train dataset with 2785 samples
[2025-07-13 12:29:17,209] [INFO] core.data_manager: Loaded hotel train dataset with 2594 samples
[2025-07-13 12:29:19,549] [INFO] core.data_manager: Loaded zara1 train dataset with 2322 samples
[2025-07-13 12:29:21,666] [INFO] core.data_manager: Loaded zara2 train dataset with 2112 samples
[2025-07-13 12:29:22,820] [INFO] core.data_manager: Loaded univ train dataset with 2076 samples
[2025-07-13 12:29:22,820] [INFO] core.data_manager: Created 5 federated clients
[2025-07-13 12:29:22,820] [INFO] core.data_manager: Preparing validation data from dataset: zara1
[2025-07-13 12:29:23,160] [INFO] core.data_manager: Loaded zara1 val dataset with 605 samples
[2025-07-13 12:29:23,160] [INFO] __main__: Created 5 federated clients
[2025-07-13 12:29:23,160] [INFO] __main__:   Client eth: 2785 samples
[2025-07-13 12:29:23,160] [INFO] __main__:   Client hotel: 2594 samples
[2025-07-13 12:29:23,160] [INFO] __main__:   Client zara1: 2322 samples
[2025-07-13 12:29:23,160] [INFO] __main__:   Client zara2: 2112 samples
[2025-07-13 12:29:23,160] [INFO] __main__:   Client univ: 2076 samples
[2025-07-13 12:29:23,160] [INFO] __main__: Validation samples: 605
[2025-07-13 12:29:23,160] [INFO] __main__: Creating federated trainer...
[2025-07-13 12:29:23,160] [INFO] core.training: Using CPU
[2025-07-13 12:29:23,160] [INFO] core.federated: Federated trainer initialized with 5 clients
[2025-07-13 12:29:23,160] [INFO] core.federated: Client weights: {'eth': 0.23425014719488602, 'hotel': 0.21818487677685255, 'zara1': 0.19530658591975775, 'zara2': 0.17764319959626546, 'univ': 0.1746151905122382}
[2025-07-13 12:29:23,160] [INFO] __main__: Client statistics:
[2025-07-13 12:29:23,160] [INFO] __main__:   Total clients: 5
[2025-07-13 12:29:23,160] [INFO] __main__:   Total samples: 11889
[2025-07-13 12:29:23,160] [INFO] __main__:   Client weights:
[2025-07-13 12:29:23,160] [INFO] __main__:     eth: 0.2343
[2025-07-13 12:29:23,160] [INFO] __main__:     hotel: 0.2182
[2025-07-13 12:29:23,160] [INFO] __main__:     zara1: 0.1953
[2025-07-13 12:29:23,160] [INFO] __main__:     zara2: 0.1776
[2025-07-13 12:29:23,160] [INFO] __main__:     univ: 0.1746
[2025-07-13 12:29:23,160] [INFO] __main__: Configuration saved to ./results/experiment_20250713_122542/federated/federated_training_20250713_122542_config.json
[2025-07-13 12:29:23,160] [INFO] __main__: Starting federated training...
[2025-07-13 12:29:23,161] [INFO] core.federated: Starting federated training for 3 rounds
[2025-07-13 12:29:23,161] [INFO] core.federated: --- Global Round 1/3 ---
[2025-07-13 12:29:23,161] [INFO] core.federated: Training client: eth
[2025-07-13 12:29:45,218] [INFO] core.federated: Training client: hotel
[2025-07-13 12:30:05,995] [INFO] core.federated: Training client: zara1
[2025-07-13 12:30:25,968] [INFO] core.federated: Training client: zara2
[2025-07-13 12:30:45,028] [INFO] core.federated: Training client: univ
[2025-07-13 12:30:59,828] [INFO] core.federated: Aggregating model updates...
[2025-07-13 12:31:01,247] [INFO] core.federated: Round 1 - Val Loss: 0.0096, ADE: 1.2710, FDE: 2.4911
[2025-07-13 12:31:01,252] [INFO] core.federated: Saved checkpoint: do_tp_federated_federated_round_1.pt
[2025-07-13 12:31:01,252] [INFO] core.federated: --- Global Round 2/3 ---
[2025-07-13 12:31:01,252] [INFO] core.federated: Training client: eth
[2025-07-13 12:31:23,223] [INFO] core.federated: Training client: hotel
[2025-07-13 12:31:44,627] [INFO] core.federated: Training client: zara1
[2025-07-13 12:32:05,012] [INFO] core.federated: Training client: zara2
[2025-07-13 12:32:24,315] [INFO] core.federated: Training client: univ
[2025-07-13 12:32:38,769] [INFO] core.federated: Aggregating model updates...
[2025-07-13 12:32:40,173] [INFO] core.federated: Round 2 - Val Loss: 0.0095, ADE: 1.2611, FDE: 2.4791
[2025-07-13 12:32:40,175] [INFO] core.federated: Saved checkpoint: do_tp_federated_federated_round_2.pt
[2025-07-13 12:32:40,175] [INFO] core.federated: --- Global Round 3/3 ---
[2025-07-13 12:32:40,176] [INFO] core.federated: Training client: eth
[2025-07-13 12:33:02,092] [INFO] core.federated: Training client: hotel
[2025-07-13 12:33:23,233] [INFO] core.federated: Training client: zara1
[2025-07-13 12:33:43,328] [INFO] core.federated: Training client: zara2
[2025-07-13 12:34:02,452] [INFO] core.federated: Training client: univ
[2025-07-13 12:34:16,902] [INFO] core.federated: Aggregating model updates...
[2025-07-13 12:34:18,299] [INFO] core.federated: Round 3 - Val Loss: 0.0095, ADE: 1.2649, FDE: 2.4849
[2025-07-13 12:34:18,300] [INFO] core.federated: Saved checkpoint: do_tp_federated_federated_round_3.pt
[2025-07-13 12:34:18,302] [INFO] core.federated: Final federated model saved: do_tp_federated_federated_final.pt
[2025-07-13 12:34:18,302] [INFO] __main__: Federated training completed!
[2025-07-13 12:34:18,302] [INFO] __main__: Best validation metrics:
[2025-07-13 12:34:18,302] [INFO] __main__:   Round: 3
[2025-07-13 12:34:18,302] [INFO] __main__:   Loss: 0.0095
[2025-07-13 12:34:18,302] [INFO] __main__:   ADE: 1.2649
[2025-07-13 12:34:18,302] [INFO] __main__:   FDE: 2.4849
[2025-07-13 12:34:18,302] [INFO] __main__: Creating training plots...
[2025-07-13 12:34:18,641] [INFO] __main__: Federated training progress plots saved
[2025-07-13 12:34:18,641] [INFO] __main__: Training metrics saved to ./results/experiment_20250713_122542/federated/federated_training_20250713_122542_metrics.json
[2025-07-13 12:34:18,641] [INFO] __main__: Federated training completed successfully!
